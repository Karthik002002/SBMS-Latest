(self.webpackChunkfalcon_react=self.webpackChunkfalcon_react||[]).push([[346],{94346:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return he}});var o=n(47313),a=n(58467),r=n(46123),i=n.n(r),s=n(29439),c=n(12153),l=n(63849),u=n(31616),h=n(40230),m=n(36287),d=n(6099),g=n(98738),v=n(13853),p=n(88815),f=n(2135),x=n(75192),j=n.n(x),b=n(46417),N=function(e){var t=e.route;return(0,b.jsx)(g.Z,{alignItems:"center",children:(0,b.jsxs)("span",{className:"nav-link-text ps-1",children:[(0,b.jsx)("input",{type:"checkbox",className:"mx-1"}),t.name||t.vehicle_reg_num||"Undefined"]})})},Z={active:j().bool,name:j().string,to:j().string,icon:j().oneOfType([j().array,j().string])};Z.children=j().arrayOf(j().shape(Z));var k=o.memo(N),L=n(34491),y=function(e){var t=e.route,n=(0,a.TH)().pathname,r=(0,o.useState)(t.vehicles.some((function e(t){return t.to===n||Object.prototype.hasOwnProperty.call(t,"vehicles")&&t.children.some(e)}))),l=(0,s.Z)(r,2),u=l[0],h=l[1];return(0,b.jsxs)(c.Z.Item,{as:"li",children:[(0,b.jsx)(c.Z.Link,{onClick:function(){h(!u)},className:i()("dropdown-indicator cursor-pointer",{"text-500":!t.active}),"aria-expanded":u,children:(0,b.jsx)(k,{route:t})}),(0,b.jsx)(p.Z,{in:u,children:(0,b.jsx)(c.Z,{className:"flex-column nav",as:"ul",children:(0,b.jsx)(S,{routes:t.vehicles,name:t.id})})})]})},S=function(e){var t=e.routes,n=e.name,a=(0,o.useContext)(d.ZP),r=a.config.showBurgerMenu,i=a.setConfig,s=function(){r&&i("showBurgerMenu",!r)};return t.map((function(e){return e.vehicles?(0,b.jsx)(y,{route:e},e.name):(0,b.jsx)(c.Z.Item,{as:"li",onClick:s,children:(0,b.jsx)(f.OL,{onClick:function(){return function(e,t){e.imei?i("currentVehicle",{vehicle:e.imei,vrn:e.vehicle_reg_num,school:t}):L.Am.error("Vehicle not associated with a tracking device")}(e,n)},className:function(t){return t.isActive&&"#!"!==e.to?"active nav-link":"nav-link"},children:(0,b.jsx)(k,{route:e})})},e.imei)}))},_=S,T=n(1413),w=n(95668),I=n(568),C=n(93298),R=function(e){return(0,b.jsx)(w.Z,(0,T.Z)((0,T.Z)({style:{position:"fixed"},id:"button-tooltip"},e),{},{children:"Toggle Navigation"}))},O=function(){var e=(0,o.useContext)(d.ZP),t=e.config,n=t.isNavbarVerticalCollapsed,a=t.isFluid,r=t.isRTL,i=e.setConfig;return(0,b.jsx)(I.Z,{placement:a?r?"bottom":"right":r?"bottom":"left",overlay:R,children:(0,b.jsx)("div",{className:"toggle-icon-wrapper",children:(0,b.jsx)(C.Z,{variant:"link",className:"navbar-toggler-humburger-icon navbar-vertical-toggle",id:"toggleNavigationTooltip",onClick:function(){document.getElementsByTagName("html")[0].classList.toggle("navbar-vertical-collapsed"),i("isNavbarVerticalCollapsed",!n)},children:(0,b.jsx)("span",{className:"navbar-toggle-icon",children:(0,b.jsx)("span",{className:"toggle-line"})})})})})},A=function(){var e=(0,o.useContext)(d.ZP).config,t=e.isNavbarVerticalCollapsed,n=e.showBurgerMenu,a=document.getElementsByTagName("html")[0].classList,r=(0,o.useState)([]),i=(0,s.Z)(r,2),p=i[0],f=i[1];(0,o.useEffect)((function(){fetch("https://sbms.elenageosys.com/user-management/map-vehicles/",{}).then((function(e){return e.json()})).then((function(e){return f(e)})).catch((function(e){return console.error(e)}))}),[]),(0,o.useEffect)((function(){return t?a.add("navbar-vertical-collapsed"):a.remove("navbar-vertical-collapsed"),function(){return a.remove("navbar-vertical-collapsed-hover")}}),[t,a]);var x=null,j=function(e){var t=e.label;return(0,b.jsx)(c.Z.Item,{as:"li",className:"mt-3",children:(0,b.jsxs)(l.Z,{className:"mt-3 mb-2 navbar-vertical-label-wrapper",children:[(0,b.jsx)(u.Z,{xs:"auto",className:"navbar-vertical-label navbar-vertical-label",children:t}),(0,b.jsx)(u.Z,{className:"ps-0",children:(0,b.jsx)("hr",{className:"mb-0 navbar-vertical-divider"})})]})})};return(0,b.jsxs)(h.Z,{expand:m.li,className:"navbar-vertical",variant:"light",children:[(0,b.jsxs)(g.Z,{alignItems:"center",children:[(0,b.jsx)(O,{}),(0,b.jsx)(v.Z,{at:"navbar-vertical",width:40})]}),(0,b.jsx)(h.Z.Collapse,{in:n,onMouseEnter:function(){t&&(x=setTimeout((function(){a.add("navbar-vertical-collapsed-hover")}),100))},onMouseLeave:function(){clearTimeout(x),a.remove("navbar-vertical-collapsed-hover")},children:(0,b.jsx)("div",{className:"navbar-vertical-content scrollbar",children:(0,b.jsx)(c.Z,{className:"flex-column",as:"ul",children:p.map((function(e){return(0,b.jsxs)(o.Fragment,{children:[(0,b.jsx)(j,{label:e.company_name}),(0,b.jsx)(_,{routes:e.schools}),(0,b.jsx)("hr",{})]},e.id)}))})})})]})},E=n(74165),z=n(15861),M=[{content:"22.55, 69.15",type:"success"},{content:"22, 69",type:"warning"}],V=new Date,D=(V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),V.toLocaleString(),n(87248)),P=n.n(D),F=(n(13723),n(93244),n(84536)),U=n(45987),B=n(34898),H=n(4552),q=n(57828);var G=["url"],J=(0,B.Lf)((function(e,t){var n=e.url,o=(0,U.Z)(e,G),a=new D.TileLayer(n,(0,H.q)(o,t));return(0,q.O)(a,t)}),(function(e,t,n){!function(e,t,n){var o=t.opacity,a=t.zIndex;null!=o&&o!==n.opacity&&e.setOpacity(o),null!=a&&a!==n.zIndex&&e.setZIndex(a)}(e,t,n);var o=t.url;null!=o&&o!==n.url&&e.setUrl(o)})),K=n(74580),W=n(39062),Q=n(93854),X=(n(77686),n(44609)),Y=n(31020),$=n(52739),ee=n(41467),te=n(71498),ne=n(45570),oe=n(91988),ae=n(71746),re=n(81722),ie=n(37840),se=n(46907),ce=function(e){var t=e.data,n=JSON.parse(window.sessionStorage.getItem("loggedInUser")),a=(0,o.useState)([]),r=(0,s.Z)(a,2),i=(r[0],r[1]),c=(0,o.useRef)({lat:null,lng:null,zoom:null}),l=(0,o.useState)(),u=(0,s.Z)(l,2),h=u[0],m=(u[1],(0,o.useState)(t)),g=(0,s.Z)(m,2),v=g[0],p=g[1],f=(0,o.useRef)(null),x=(0,re.K)(),j=x.TrackingVehicleCenter,N=x.ZoomLevel,Z=(x.setZoomLevel,x.IMEI),k=x.HistoryTrackingActive;x.setMarkerData;function L(){var e=(0,F.Sx)(),t=(0,o.useContext)(d.ZP).config,n=t.isDark;(0,o.useContext)(d.ZP).config.currentVehicle;e.on("drag",(function(){var t=e.getCenter(),n=e.getZoom();c.current={lat:t.lat,lng:t.lng,zoom:n}})),e.on("zoomend",(function(){var t=e.getCenter(),n=e.getZoom();c.current={lat:t.lat,lng:t.lng,zoom:n}}));var a=n?["invert:98%","grayscale:69%","bright:99%","contrast:111%","hue:203deg","saturate:1000%"]:["bright:101%","contrast:101%","hue:23deg","saturate:225%"];return(0,o.useEffect)((function(){e.invalidateSize()}),[t]),(0,o.useEffect)((function(){e&&P().tileLayer.colorFilter("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:null,transparent:!0,filter:a}).addTo(e)}),[n]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J,{attribution:null,url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",maxNativeZoom:21,maxZoom:21}),k&&(0,b.jsx)(ie.Z,{})]})}function y(){var e=[];return null===v||void 0===v||v.forEach((function(t){var n=function(e,t){var n;switch(e){case 0:n="Running";break;case 1:n="Idle";break;case 2:n="Stopped";break;case 3:n="Towed";break;case 4:n="No Data";break;case 5:n="Out of Network";break;case 6:n="Parked";break;default:n="-"}return t&&(n="RashDriving"),{statusText:n}}(t.status,t.speed_status);e.push({position:[t.lat,t.lon],companyName:t.Company_name,CompanyID:t.company_id,SchoolID:t.school_id,schoolName:t.school_name,vehicleName:t.vehicle_name,VehicleReg:t.vehicle_reg,imei:t.imei,popupText:[{VehicleReg:t.vehicle_reg,vehicleName:t.vehicle_name,driver:t.driver,driverPhone:t.phone,status:null===n||void 0===n?void 0:n.statusText}],markerIcons:(0,D.divIcon)({className:"custom-marker-icon",html:'<img src="'.concat(t.speed_status?te:0===t.status?X:1===t.status?Y:2===t.status?$:3===t.status?ee:4===t.status?ne:5===t.status?oe:ae,'" style="transform: rotate(').concat(t.heading,'deg)" width="20" height="30" />'),iconSize:[25,41],iconAnchor:[21,36],popupAnchor:[1,-34]})})})),(0,b.jsx)("div",{className:"map-container",children:(0,b.jsxs)(K.h,{zoom:null!==c.current.zoom?c.current.zoom:N,scrollWheelZoom:!!t,zoomControl:!!t,dragging:!!t,doubleClickZoom:!!t,center:c.current&&null!==c.current.lat?[c.current.lat,c.current.lng]:j||[13.422925089909123,77.9857877043398],ref:f,radius:200,style:{height:"90vh",width:"100%"},children:[!k&&e.map((function(e,t){return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(W.J,{position:e.position,icon:e.markerIcons,children:(0,b.jsxs)(Q.G,{children:[(0,b.jsx)("p",{className:"m-0 text-500"}),e.popupText.map((function(e,t){return(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"m-0 text-500",children:["Vehicle Name: ",e.vehicleName]}),(0,b.jsxs)("p",{className:"m-0 text-500",children:["Vehicle Reg No: ",e.VehicleReg]}),(0,b.jsxs)("p",{className:"m-0 text-500",children:["Status: ",e.status]})]},t)}))]})},t)})})),(0,b.jsx)(L,{})]})})}return(0,o.useEffect)((function(){j&&(c.current={lat:null,lng:null,zoom:null})}),[j,k]),(0,o.useEffect)((function(){if(null!==Z&&!k){var e="".concat(se.qe,"?imei=").concat(Z),t=function(){var t=(0,z.Z)((0,E.Z)().mark((function t(){var o,a;return(0,E.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e,{method:"GET",headers:{Authorization:"token ".concat(n.token)}});case 3:if(200!=(o=t.sent).status){t.next=9;break}return t.next=7,o.json();case 7:a=t.sent,i(a);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}();t();var o=setInterval((function(){t()}),5e3);return function(){return clearInterval(o)}}}),[Z,k]),(0,o.useEffect)((function(){p(h)}),[h]),(0,o.useEffect)((function(){k||p(t)}),[t]),(0,b.jsx)(y,{})},le=(0,o.memo)(ce),ue=function(){var e=(0,a.TH)(),t=e.hash,n=e.pathname,r=n.includes("kanban");return(0,o.useEffect)((function(){setTimeout((function(){if(t){var e=t.replace("#",""),n=document.getElementById(e);n&&n.scrollIntoView({block:"start",behavior:"smooth"})}}),0)}),[]),(0,o.useEffect)((function(){window.scrollTo(0,0)}),[n]),(0,b.jsxs)("div",{className:"container-fluid",children:[(0,b.jsx)(A,{}),(0,b.jsx)("div",{className:i()("content",{"pb-0":r}),children:(0,b.jsx)("div",{className:"mt-5",children:(0,b.jsx)(le,{})})})]})},he=function(){return(0,b.jsx)(ue,{})}},77686:function(){!function(){var e=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook((function(){var e=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;e&&(e=e[0]+"px "+e[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||e||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",(function(e){e.target._applyRotation()}))})),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})}()}}]);